version: '3.8'

services:
  # ========== ASSIGNMENTS SERVICE ==========
  assignments-service:
    build:
      context: ./assignments-service
      dockerfile: Dockerfile
    container_name: frog-assignments-service
    # ⬇️ contenedor escucha en 8002 y exponemos 8002
    ports:
      - "8002:8002"
    env_file:
      - ./assignments-service/.env
    environment:
      - PORT=8002
      - SERVICE_NAME=assignments-service
      # ruta dentro del contenedor al key de Firebase
      - FIREBASE_CREDENTIALS=/app/assignments-service-key.json
    volumes:
      - ./assignments-service/app:/app/app
      # montamos el json de firebase en /app/firebasekey.json
      - ./assignments-service/assignments-service-key.json:/app/assignments-service-key.json:ro
    networks:
      - frog-network
    restart: unless-stopped
  

  # ========== LMS INTEGRATION ==========
  lms-integration:
    build:
      context: ./lms-integration
      dockerfile: Dockerfile
    container_name: frog-lms-integration
    # ⬇️ contenedor escucha en 8005 y exponemos 8005
    ports:
      - "8005:8005"
    env_file:
      - ./lms-integration/.env
    environment:
      - PORT=8005
      - SERVICE_NAME=lms-integration
      # este servicio necesita llamar al assignments-service
      - ASSIGNMENTS_SERVICE_URL=http://assignments-service:8002
      - LMS_TYPE=${LMS_TYPE:-moodle}
      - LMS_API_URL=${LMS_API_URL}
      - LMS_API_KEY=${LMS_API_KEY}
      # si en tu código usas una key tipo Firebase / Google:
      - FIREBASE_CREDENTIALS=/app/lms-service-key.json
    volumes:
      - ./lms-integration/app:/app/app
      # montamos la key específica del servicio LMS (si la usas)
      - ./lms-integration/lms-service-key.json:/app/lms-service-key.json:ro
    networks:
      - frog-network
    restart: unless-stopped

networks:
  frog-network:
    driver: bridge
