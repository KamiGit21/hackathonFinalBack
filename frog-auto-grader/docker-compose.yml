version: '3.8'

services:
  # ========== ASSIGNMENTS SERVICE ==========
  assignments-service:
    build:
      context: ./assignments-service
      dockerfile: Dockerfile
    container_name: frog-assignments-service
    # ‚¨áÔ∏è contenedor escucha en 8002 y exponemos 8002
    ports:
      - "8002:8002"
    env_file:
      - ./assignments-service/.env
    environment:
      - PORT=8002
      - SERVICE_NAME=assignments-service
      # ruta dentro del contenedor al key de Firebase
      - FIREBASE_CREDENTIALS=/app/assignments-service-key.json
    volumes:
      - ./assignments-service/app:/app/app
      # montamos el json de firebase en /app/firebasekey.json
      - ./assignments-service/assignments-service-key.json:/app/assignments-service-key.json:ro
    networks:
      - frog-network
    restart: unless-stopped
  
  execution-service:
    build:
      context: ./execution-service
      dockerfile: Dockerfile
    container_name: frog-execution-service
    ports:
      - "8003:8003"
    env_file:
      - ./execution-service/.env
    environment:
      - PORT=8003
      - SERVICE_NAME=execution-service
      # üëá ruta interna al JSON de Firebase
      - FIREBASE_CREDENTIALS=/app/secrets/firebase-credentials.json
    volumes:
      - ./execution-service/app:/app/app
      # montamos la carpeta secrets con el json
      - ./execution-service/secrets:/app/secrets:ro
    networks:
      - frog-network
    restart: unless-stopped

  # ========== LMS INTEGRATION ==========
  lms-integration:
    build:
      context: ./lms-integration
      dockerfile: Dockerfile
    container_name: frog-lms-integration
    # ‚¨áÔ∏è contenedor escucha en 8005 y exponemos 8005
    ports:
      - "8005:8005"
    env_file:
      - ./lms-integration/.env
    environment:
      - PORT=8005
      - SERVICE_NAME=lms-integration
      # este servicio necesita llamar al assignments-service
      - ASSIGNMENTS_SERVICE_URL=http://assignments-service:8002
      - LMS_TYPE=${LMS_TYPE:-moodle}
      - LMS_API_URL=${LMS_API_URL}
      - LMS_API_KEY=${LMS_API_KEY}
      # si en tu c√≥digo usas una key tipo Firebase / Google:
      - FIREBASE_CREDENTIALS=/app/lms-service-key.json
    volumes:
      - ./lms-integration/app:/app/app
      # montamos la key espec√≠fica del servicio LMS (si la usas)
      - ./lms-integration/lms-service-key.json:/app/lms-service-key.json:ro
    networks:
      - frog-network
    restart: unless-stopped
  plagiarism-service:
    build: .
    container_name: plagiarism-service
    ports:
      - "8005:8000"
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/app/serviceAccountKey.json
    volumes:
      - ./app/serviceAccountKey.json:/app/serviceAccountKey.json:ro
    restart: unless-stopped
    
networks:
  frog-network:
    driver: bridge
